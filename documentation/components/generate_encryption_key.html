<style>
  .api-key-input {
    display: flex;
    gap: 0.5em;
    align-items: center;
  }
  .api-key-input input[type='text'] {
    width: 490px;
    max-width: 98vw;
    background: unset;

    border: 0.1rem solid;
    border-radius: 0.1rem;
    border-color: var(--md-typeset-a-color);
    color: var(--md-primary-bg-color);
    cursor: pointer;
    display: inline-block;
    font-weight: 700;
    transition: color 125ms, background-color 125ms, border-color 125ms;
    padding-top: 0.6em;
    padding-bottom: 0.625rem;
  }
  .api-key-input input[type='text']:focus,
  .api-key-input input[type='text']:hover {
    background-color: var(--md-accent-fg-color);
    border-color: var(--md-accent-fg-color);
    color: var(--md-accent-bg-color);
  }
</style>
<div class="api-key-input">
  <input type="text" id="api-key" onclick="this.focus();this.select()" readonly="readonly" />
  <button type="button" id="regenerate-api-key" aria-label="Regenerate API key" class="md-button">Regenerate</button>
  <button type="button" id="copy-api-key" aria-label="Copy API key" class="md-button md-button--primary">Copy</button>
</div>
<script>
  // https://stackoverflow.com/a/62362724
  function bytesArrToBase64(arr) {
    const abc = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'; // base64 alphabet
    const bin = (n) => n.toString(2).padStart(8, 0); // convert num to 8-bit binary string
    const l = arr.length;
    let result = '';
    for (let i = 0; i <= (l - 1) / 3; i++) {
      let c1 = i * 3 + 1 >= l; // case when "=" is on end
      let c2 = i * 3 + 2 >= l; // case when "=" is on end
      let chunk = bin(arr[3 * i]) + bin(c1 ? 0 : arr[3 * i + 1]) + bin(c2 ? 0 : arr[3 * i + 2]);
      let r = chunk.match(/.{1,6}/g).map((x, j) => (j === 3 && c2 ? '=' : j === 2 && c1 ? '=' : abc[+('0b' + x)]));
      result += r.join('');
    }
    return result;
  }

  function updateApiKey() {
    let array = new Uint8Array(32);
    window.crypto.getRandomValues(array);
    document.getElementById('api-key').value = bytesArrToBase64(array);
  }
  updateApiKey();
  document.getElementById('regenerate-api-key').addEventListener('click', function () {
    updateApiKey();
  });

  document.getElementById('copy-api-key').addEventListener('click', function () {
    var input = document.getElementById('api-key');
    input.select();
    input.setSelectionRange(0, 99999); // For mobile
    navigator.clipboard.writeText(input.value).then(function () {
      var copyButton = document.getElementById('copy-api-key');
      copyButton.innerHTML = 'Copied!';
      copyButton.focus();
      setTimeout(function () {
        copyButton.innerHTML = 'Copy';
      }, 1200);
    });
  });
</script>
